
@{
    ViewBag.Title = "CotrolPanel";
}

<h2>Centrum dowodzenia</h2>
<div class="childrenInline">
    @for (var index = 1; index <= 5; index++)
    {
        <div class="exeSlots">
            Otwórz plik/stronę www/folder
            <input type="text" id="pathOfFileToOpen" class="form-control" placeholder="Sciezka" />
            <input type="text" id="arguments" class="form-control" placeholder="Argumenty" />
            <input type="checkbox" id="closeAfterExecuting" />
            <span>Zamknij launcher po uruchomieniu pliku</span><br />

            <input type="checkbox" id="hideAfterExecuting" />
            <span>Ukryj uruchamiany plik </span><br />

            <button id="openFile3" class="btn btn-default runExeButton">Uruchom</button>
        </div>
    }

    <div class="exeSlots">
        Utwórz plik tekstowy
        <input type="text" id="fileName" class="form-control" placeholder="Ścieżka do pliku" />
        <textarea id="textToFile" class="form-control" placeholder="Zawartosc pliku"></textarea>
        <button id="createFile" class="btn btn-default">Utworz plik</button>
    </div>

    <p><b>Używając cmd.exe</b> przed komendą wstaw "/c", inaczej nie będzie działać</p>

    <button id="closeFile" class="btn btn-default">CloseExe (0)</button><br />Uwaga, można zamknąć tylko ostatnio otworzony plik. Wszystkie poprzednie pozostana otwarte.<br />

    <button id="askToBeAdmin" class="btn btn-default">Spytaj czy możesz być adminem</button><br />

    <button id="askToShowAllUsers" class="btn btn-default">Pokaż wszystkich użytkowników</button><br />

    <input type="text" id="newNickname" class="form-control" placeholder="Twoja nowa nazwa uzytkownika" style="display: inline" />
    <button id="changeNickname" class="btn btn-default">Zmień nazwę użytkownika</button><br />

    <input type="text" id="newChatMessage" class="form-control" placeholder="Wpisz wiadomosc" style="display: inline" />
    <button id="sendMessage" class="btn btn-default">Wyślij (Enter)</button><br />
</div>

<div id="console"></div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script>
        console.log("Tylko nie zepsuj :/");
        $(function () {
            var hub = $.connection.myHub1;
            $.connection.hub.qs = { 'AppVersion': '100000' }; //query strings

            hub.client.serverResponse = function (data) {
                $('#console').prepend("<span class='serverMessage'>" + data + "</span>");
            };

            hub.client.clientMessage = function (data) {
                $('#console').prepend("<span class='chatMessage'>chat: " + data[0] + ": " + data[1] + "</span>");
            };

            hub.client.youveBecomeAdmin = function (data) {
                $('#console').prepend("<span>" + data + " zaakceptowal cie jako admina</span>");
            };

            function sendMessage(message) {
                $('#console').prepend("<span class='chatMessage'>chat: " + message + "</span>");
                hub.server.serverMessage("" + message);
            }

            $.connection.hub.start().done(function () {
                //hub.server.serverMessage("***New website user connected");
                sendMessage("***New website user connected");

                $(".runExeButton").click(function () {
                    var parent = $(this).parent();
                    var path = parent.find("#pathOfFileToOpen").val();
                    var arguments = parent.find("#arguments").val();
                    var close = parent.find("#closeAfterExecuting").is(":checked");
                    var hide = parent.find("#hideAfterExecuting").is(":checked");
                    console.log("Data: " + path + " " + arguments + " " + hide + " " + close);
                    hub.server.openExeEverywhere(path, arguments, close, hide);
                    //hub.server.serverMessage("Wysyłam żądanie otwarcia pliku " + path + " z argumentami: '" + arguments + "'");
                    sendMessage("Wysyłam żądanie otwarcia pliku " + path + " z argumentami: '" + arguments + "'");
                });

                $("#createFile").click(function () {
                    var parent = $(this).parent();
                    var path = parent.find("#fileName").val();
                    var content = parent.find("#textToFile").val();
                    hub.server.createFileAndWrite(path, content);
                });

                $("#closeFile").click(function () {
                    hub.server.closeExeEverywhere();
                });

                $("#changeNickname").click(function () {
                    hub.server.setNickname("" + $("#newNickname").val());
                });

                $("#askToBeAdmin").click(function () {
                    hub.server.askToBeAdmin();
                });

                $("#askToShowAllUsers").click(function () {
                    hub.server.getAllUsers();
                });

                $("#sendMessage").click(function () {
                    //$('#console').prepend("<span class='chatMessage'>chat: " + $("#newChatMessage").val() + "</span>");
                    //hub.server.serverMessage("" + $("#newChatMessage").val());
                    sendMessage($("#newChatMessage").val());
                    $("#newChatMessage").val("");
                    $("#newChatMessage").focus();
                });
            });


            $(document).keypress(function (e) {
                //console.log(e.which || e.keyCode);
                var keyCode = e.which || e.keyCode;

                if (keyCode == 49) { //1
                    $("#openFile1").click();
                }
                if (keyCode == 50) { //2
                    $("#openFile2").click();
                }
                if (keyCode == 51) { //3
                    $("#openFile3").click();
                }
                if (keyCode == 13) { //Enter
                    $("#sendMessage").click();
                }
                if (keyCode == 48) { //0
                    $("#closeFile").click();
                }
            });

        });
    </script>
}